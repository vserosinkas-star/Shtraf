<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–≥–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è —à—Ç—Ä–∞—Ñ–æ–≤</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .header-logo {
      max-height: 60px; /* —Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –ø–æ –∂–µ–ª–∞–Ω–∏—é */
      width: auto;
      margin: 0.5rem 0;
      object-fit: contain;
    }
    header {
      background: linear-gradient(135deg, #0d47a1, #1976d2);
      color: white;
      padding: 1.5rem 2rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 1rem;
    }

    .logo-text {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .check-button {
      background-color: #ff5722;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .check-button:hover {
      background-color: #e64a19;
    }

    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }

    /* –í–∫–ª–∞–¥–∫–∏ */
    .tabs {
      display: flex;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .tab {
      flex: 1;
      padding: 1rem;
      text-align: center;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab.active {
      background-color: #e3f2fd;
      color: #1976d2;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    section {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    h2 {
      margin-bottom: 1.2rem;
      color: #1976d2;
    }

    /* –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
    .add-form-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      align-items: center;
    }

    .add-form-inline input {
      flex: 1;
      min-width: 120px;
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 0.95rem;
    }

    .add-form-inline button {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      font-size: 0.95rem;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      white-space: nowrap;
    }

    .add-form-inline button:hover {
      background-color: #1565c0;
    }

    /* –¢–∞–±–ª–∏—Ü—ã */
    .vehicles-table,
    .fines-table,
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.95rem;
    }

    .vehicles-table th,
    .vehicles-table td,
    .fines-table th,
    .fines-table td,
    .history-table th,
    .history-table td {
      padding: 0.6rem 0.8rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .vehicles-table th,
    .fines-table th,
    .history-table th {
      background-color: #f8f9fa;
      color: #1976d2;
      font-weight: 600;
    }

    .amount-paid {
      color: #388e3c;
    }

    .amount-unpaid {
      color: #d32f2f;
      font-weight: bold;
    }

    .status-paid {
      background-color: #e8f5e9;
      color: #2e7d32;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .status-unpaid {
      background-color: #ffebee;
      color: #c62828;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    /* –î–µ–π—Å—Ç–≤–∏—è */
    .actions-cell {
      display: flex;
      gap: 0.4rem;
      justify-content: flex-start;
      white-space: nowrap;
    }

    .btn-action {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.35rem;
      min-width: 32px;
      height: 32px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      gap: 0.3rem;
    }

    .btn-edit {
      background-color: #e3f2fd;
      color: #1976d2;
    }
    .btn-history {
      background-color: #f1f8e9;
      color: #388e3c;
    }
    .btn-delete {
      background-color: #ffebee;
      color: #d32f2f;
    }

    .btn-action:hover {
      opacity: 0.9;
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–µ */
    @media (max-width: 650px) {
      .btn-action {
        padding: 0;
        min-width: 32px;
        width: 32px;
        height: 32px;
        font-size: 0;
      }
      .btn-action span:last-child {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .add-form-inline {
        flex-direction: column;
        align-items: stretch;
      }
      .add-form-inline button {
        align-self: stretch;
        text-align: center;
      }
      .tabs {
        flex-direction: column;
      }
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
    .alert {
      padding: 1rem;
      border-radius: 6px;
      margin-top: 1rem;
      background-color: #e8f5e9;
      color: #2e7d32;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    footer {
      text-align: center;
      padding: 1.5rem;
      color: #666;
      font-size: 0.9rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

  <header>
    <div class="logo-text">–ê–≥–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è —à—Ç—Ä–∞—Ñ–æ–≤</div>
	<img src="/static/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="header-logo">
    <form method="post" action="/check-now" style="margin: 0;">
      <button type="submit" class="check-button">
        <span class="material-icons">sync</span>
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —à—Ç—Ä–∞—Ñ—ã
      </button>
    </form>
  </header>

  <main>
    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
      <div class="tab active" data-tab="fines">–®—Ç—Ä–∞—Ñ—ã</div>
      <div class="tab" data-tab="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div>
      <div class="tab" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</div>
    </div>

<!-- –í–∫–ª–∞–¥–∫–∞: –®—Ç—Ä–∞—Ñ—ã -->
<div class="tab-content active" id="fines">
  {% if fines_unpaid or fines_paid %}
    {% if fines_unpaid %}
    <section>
      <h2>üö® –ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã ({{ fines_unpaid|length }})</h2>
      <table class="fines-table">
        <thead>
          <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–ê–≤—Ç–æ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–°—É–º–º–∞</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for f in fines_unpaid %}
          <tr>
            <td>{{ f[0] }}</td>
            <td>{{ f[5] }}</td>
            <td>{{ f[2] or '‚Äî' }}</td>
            <td class="amount-unpaid">{{ f[1] }} ‚ÇΩ</td>
            <td class="actions-cell">
              {% if f[4] %}
              <a href="{{ f[4] }}" target="_blank" class="btn-action btn-history" title="–ü–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ">
                <span class="material-icons">description</span>
                <span>–ü–æ—Å—Ç.</span>
              </a>
              {% endif %}
              <a href="/pay/{{ f[3] }}" class="btn-action btn-history" title="–û–ø–ª–∞—Ç–∏—Ç—å">
                <span class="material-icons">payment</span>
                <span>–û–ø–ª.</span>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    {% endif %}

    {% if fines_paid %}
    <section>
      <h2>‚úÖ –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã</h2>
      <table class="fines-table">
        <thead>
          <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–ê–≤—Ç–æ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–°—É–º–º–∞</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
          </tr>
        </thead>
        <tbody>
          {% for f in fines_paid %}
          <tr>
            <td>{{ f.fine_date }}</td>
            <td>{{ f.car_number }}</td>
            <td>{{ f.description or '‚Äî' }}</td>
            <td class="amount-paid">{{ f.fine_sum }} ‚ÇΩ</td>
            <td><span class="status-paid">–û–ø–ª–∞—á–µ–Ω</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    {% endif %}
  {% else %}
    <section>
      <p>–ù–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤.</p>
    </section>
  {% endif %}
</div>
    <!-- –í–∫–ª–∞–¥–∫–∞: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç -->
    <div class="tab-content" id="transport">
      <section>
        <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h2>
        <form method="post" action="/add" class="add-form-inline">
          <input type="text" name="car_number" placeholder="–ù–æ–º–µ—Ä –∞–≤—Ç–æ (–ê123–ë–í777)" required>
          <input type="text" name="sts_number" placeholder="–°–¢–° (—Å–µ—Ä–∏—è –∏ –Ω–æ–º–µ—Ä)" required>
          <input type="email" name="email" placeholder="Email 1 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)" required>
          <input type="email" name="email2" placeholder="Email 2 (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)">
          <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
          <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
      </section>

      {% if vehicles %}
      <section>
        <h2>üöó –í–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ ({{ vehicles|length }})</h2>
        <table class="vehicles-table">
          <thead>
            <tr>
              <th>–ê–≤—Ç–æ</th>
              <th>–°–¢–°</th>
              <th>Email</th>
              <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {% for v in vehicles %}
            <tr>
              <td><strong>{{ v[1] }}</strong></td>
              <td>{{ v[2] }}</td>
              <td>
                {{ v[3] }}<br>
                {% if v[4] %}<small>{{ v[4] }}</small>{% endif %}
              </td>
              <td>{{ v[5] or '‚Äî' }}</td>
              <td class="actions-cell">
                <a href="/edit/{{ v[0] }}" class="btn-action btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                  <span class="material-icons">edit</span>
                  <span>–†–µ–¥.</span>
                </a>
                <a href="/history/{{ v[0] }}" class="btn-action btn-history" title="–ò—Å—Ç–æ—Ä–∏—è">
                  <span class="material-icons">history</span>
                  <span>–ò—Å—Ç.</span>
                </a>
                <form method="post" action="/delete/{{ v[0] }}" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å?')" style="display:inline;">
                  <button type="submit" class="btn-action btn-delete" title="–£–¥–∞–ª–∏—Ç—å">
                    <span class="material-icons">delete</span>
                    <span>–£–¥.</span>
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      {% endif %}
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞: –ò—Å—Ç–æ—Ä–∏—è -->
    <div class="tab-content" id="history">
      {% if all_fines %}
      <section>
        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è —à—Ç—Ä–∞—Ñ–æ–≤</h2>
        <table class="history-table">
          <thead>
            <tr>
              <th>–î–∞—Ç–∞ —à—Ç—Ä–∞—Ñ–∞</th>
              <th>–ê–≤—Ç–æ</th>
              <th>–°—É–º–º–∞</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–û–±–Ω–∞—Ä—É–∂–µ–Ω</th>
            </tr>
          </thead>
          <tbody>
            {% for f in all_fines %}
            <tr>
              <td>{{ f.fine_date }}</td>
              <td>{{ f.car_number }}</td>
              <td>{{ f.fine_sum }} ‚ÇΩ</td>
              <td>
                {% if f.is_paid %}
                  <span class="status-paid">–û–ø–ª–∞—á–µ–Ω</span>
                {% else %}
                  <span class="status-unpaid">–ù–µ –æ–ø–ª–∞—á–µ–Ω</span>
                {% endif %}
              </td>
              <td>{{ f.detected_at[:16].replace('T', ' ') }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      {% else %}
        <section>
          <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</p>
        </section>
      {% endif %}
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    {% if "manual" in request.query_params %}
    <div class="alert">
      <span class="material-icons">check_circle</span>
      –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞. –ù–æ–≤—ã–µ —à—Ç—Ä–∞—Ñ—ã –ø—Ä–∏–¥—É—Ç –Ω–∞ email.
    </div>
    {% endif %}
  </main>

  <footer>
    &copy; 2025 –ê–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —à—Ç—Ä–∞—Ñ–æ–≤. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
  </footer>

  <script>
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });
  </script>
</body>
</html>